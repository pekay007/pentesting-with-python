#!/usr/bin/python3

import socket
import sys
import threading


def check_port(ipaddr, port):

    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        result = sock.connect_ex((ipaddr, port))
        if result == 0:
            print(f'{ipaddr}:{port} is open')
    except Exception as e:
        print(str(e))
    finally:
        sock.close()


def main(thread_lmt=10):

    threads = []
    count = 0

    for i in range(0, 1024):
        t = threading.Thread(target=check_port, args=[sys.argv[1], i])
        t.start()
        threads.append(t)
        count += 1

        if count % thread_lmt == 0:
            for thread in threads:
                thread.join()
            threads.clear()


if __name__ == '__main__':
    if len(sys.argv) == 2:
        main()
    elif len(sys.argv) == 3:
        main(int(sys.argv[2]))
    else:
        print(f'Usage : {sys.argv[0]} <ipaddress> <thread_count>')
