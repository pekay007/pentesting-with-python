#!/usr/bin/python3
from iprottation import IProtator, banner


def response_handler(response, payload):

    if response.status_code == 200:
        print(f'{response.url}      -        {response.status_code}')


def wordlist(filename):
    with open(filename) as fileobj:
        for word in fileobj:
            yield word.rstrip()


def url_generator(url, wordlist):
    wordlists = []
    for word in wordlist:
        data = [url+'/'+word, {}]
        wordlists.append(data)
    return wordlists


def main():

    banner()

    dictionary = wordlist('/usr/share/wordlists/dirb/common.txt')
    url = url_generator('https://example.com', dictionary)
    method = 'GET'
    thread_lmt = 15
    handler = response_handler
    sleep_time = 10
    processes = []

    portconf = [[20001, 20002], [20003, 20004]]
    torrcBase = '/tmp/torrc.'
    count = 1
    procees_lmt = 2
    step = len(url)/procees_lmt

    for index in range(0, len(url), step):
        torrc = torrcBase+str(count)
        proc = IProtator(
            url[index:index+step], method, thread_lmt, handler,
            sleep_time, ctrlPort=portconf[index][0],
            torPort=portconf[index][1], torrcPath=torrc)
        proc.start()
        processes.append(proc)
        count += 1

    for process in processes:
        process.join()


if __name__ == '__main__':

    main()
